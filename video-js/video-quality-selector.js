// https://github.com/dominic-p/videojs-resolution-selector
!function(e){var t={res_label:function(e){return/^\d+$/.test(e)?e+"p":e}};e.ResolutionMenuItem=e.MenuItem.extend({call_count:0,init:function(n,l){l.label=t.res_label(l.res),l.selected=l.res.toString()===n.getCurrentRes().toString(),e.MenuItem.call(this,n,l),this.resolution=l.res,this.on(["click","tap"],this.onClick),n.on("changeRes",e.bind(this,function(){this.resolution==n.getCurrentRes()?this.selected(!0):this.selected(!1),this.call_count=0}))}}),e.ResolutionMenuItem.prototype.onClick=function(){this.call_count>0||(this.player().changeRes(this.resolution),this.call_count++)},e.ResolutionTitleMenuItem=e.MenuItem.extend({init:function(t,n){e.MenuItem.call(this,t,n),this.off("click")}}),e.ResolutionSelector=e.MenuButton.extend({init:function(t,n){t.availableRes=n.available_res,e.MenuButton.call(this,t,n),this.el().firstChild.firstChild.innerHTML=n.buttonText}}),e.ResolutionSelector.prototype.className="vjs-res-button",e.ResolutionSelector.prototype.createItems=function(){var t,n=this.player(),l=[];l.push(new e.ResolutionTitleMenuItem(n,{el:e.Component.prototype.createEl("li",{className:"vjs-menu-title vjs-res-menu-title",innerHTML:n.localize("Quality")})}));for(t in n.availableRes)"length"!=t&&l.push(new e.ResolutionMenuItem(n,{res:t}));return l.sort(function(e,t){return"undefined"==typeof e.resolution?-1:parseInt(t.resolution)-parseInt(e.resolution)}),l},e.plugin("resolutionSelector",function(n){if(this.el().firstChild.canPlayType){for(var l,o,r,s=this,i=s.options().sources,a=i.length,u=e.util.mergeOptions({default_res:"",force_types:!1},n||{}),c={length:0},f=u.default_res&&"string"==typeof u.default_res?u.default_res.split(","):[];a>0;)a--,i[a]["data-res"]&&(o=i[a]["data-res"],"object"!=typeof c[o]&&(c[o]=[],c.length++),c[o].push(i[a]));if(u.force_types)for(o in c)if("length"!=o){for(a=u.force_types.length,found_types=0;a>0;)for(a--,l=c[o].length;l>0;)if(l--,u.force_types[a]===c[o][l].type){found_types++;break}found_types<u.force_types.length&&(delete c[o],c.length--)}if(!(c.length<2)){for(a=0;a<f.length;a++)if(c[f[a]]){s.src(c[f[a]]),s.currentRes=f[a];break}"function"!=typeof s.localize&&(s.localize=function(e){return e}),s.getCurrentRes=function(){if("undefined"!=typeof s.currentRes)return s.currentRes;try{return res=s.options().sources[0]["data-res"]}catch(e){return""}},s.changeRes=function(e){var n,l,o=s.el().firstChild,r=s.paused(),i=s.currentTime();if(s.getCurrentRes()!=e&&s.availableRes&&s.availableRes[e]){if("none"==o.preload&&(o.preload="metadata"),s.src(s.availableRes[e]).one("loadedmetadata",function(){s.currentTime(i),s.addClass("vjs-has-started"),r||s.play()}),s.currentRes=e,s.controlBar.resolutionSelector)for(n=s.controlBar.resolutionSelector.el().firstChild.children,l=n.length;l>0;)if(l--,"vjs-control-text"==n[l].className){n[l].innerHTML=t.res_label(e);break}s.trigger("changeRes")}},o=s.getCurrentRes(),o&&(o=t.res_label(o)),r=new e.ResolutionSelector(s,{buttonText:s.localize(o||"Quality"),available_res:c}),s.controlBar.resolutionSelector=s.controlBar.addChild(r)}}})}(videojs);
