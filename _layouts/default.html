<!DOCTYPE html>
<html>
	{% include head.html %}

	<body>
		        <div id="pageContent">
		        {% include header.html %}
		        {% include page_content.html %}
		        {% include contact.html %}
		        {% include footer.html %}
		        </div>
		        
		    <div id="extraScroll">
		        <img id="downArrow" src="images/downarrow.svg">
		        <div id="presentText">
	                <div id="presentTextInner">
	                    <h1>Your Project is Next.</h1>
	                    <p>Together we can build something great.<br>Let's get in touch: <a href="mailto:maxlaumeister@gmail.com">max.laumeister@gmail.com</a>
	                </div>
	            </div>
	            <div id="iframeWrapper">
	                
	                <div id="iframeInner">
	                    <div id="browserDecoration">
	                        <div id="bbuttons">
	                            <div class="bbutton bbutton1">
	                            </div>
	                            <div class="bbutton bbutton2">
	                            </div>
	                            <div class="bbutton bbutton3">
	                            </div>
	                        </div>
	                    </div>
	                    <div id="browserURL">
	                        <div>
	                            <div id="browserForwardBack">
	                                <img id="browserBack" src="images/backbutton.svg"><img id="browserForward" src="images/backbutton.svg">
	                            </div>
	                            <div id="browserURLinputcell">
	                                <input id="browserURLinput" type="text" readonly="readonly">
	                            </div>
	                        </div>
	                    </div>
	                </div>
		        </div>
		{% include js.html %}
		<script>
		    var pageWrapperEl = document.getElementById("pageWrapper");
		    var pageContentEl = document.getElementById("pageContent");
		    var presentTextEl = document.getElementById("presentText");
		    var iframeWrapperEl = document.getElementById("iframeWrapper");
		    var iframeInnerEl = document.getElementById("iframeInner");
		    var browserURLinput = document.getElementById("browserURLinput");
		    var downArrowEl = document.getElementById("downArrow");
		    var extraScrollEl = document.getElementById("extraScroll");
		    var scrollDelta = 0;
		    var lastScroll = 0;
		    var extraScrollHeight;
		    
		    var ciframe;
		    
	        var navEl = document.getElementsByClassName("navbar")[0];
	        
	        var navIsHidden = false;
	        var backgroundIsHidden = true;
	        var iframeRequested = false;
	        var iframeLoaded = false;
	        
	        var pageHeight;
	        var windowHeight;
	        
	        function resize() {
	            pageHeight = pageContentEl.offsetHeight;
	            windowHeight = window.innerHeight;
	            extraScrollHeight = extraScrollEl.offsetHeight;
	        }
	         window.addEventListener("resize", resize, false);
	         resize();
	        
	        var revealing = false;
	        
	        function revealPresentation() {
	           revealing = true;
	           $('html, body').animate({
                   scrollTop: $("#contact").offset().top
                 }, 750, function() {
                    revealing = false;
                 });
                 
	        }
	        
	        var scrollingTimeout;
	        
	        function scrollChange() {
	            var currScroll = window.scrollY;
	            scrollDelta = currScroll - lastScroll;
	            lastScroll = currScroll;
	            
	            var scrollBottom = windowHeight + window.scrollY;
	            
	            if (scrollBottom >= pageHeight + extraScrollHeight / 3 && !revealing && scrollDelta > 0) {
	                clearTimeout(scrollingTimeout);
	                scrollingTimeout = setTimeout(revealPresentation, 500);
	                revealing = true;
	            }
	            
	            if (scrollBottom >= pageHeight + extraScrollHeight / 3 && revealing && scrollDelta < 0) {
	                $('html, body').stop();
	                revealing = false;
	            }
	            
	            if (currScroll + 10 >= pageHeight && !navIsHidden) {
	                function checkiframeReadyState() {
	                    if (!iframeLoaded) {
	                        requestAnimationFrame(checkiframeReadyState);
	                        return;
	                    }
	                    if (!navIsHidden) return;
	                    navEl.classList.add("tucked");
	                    iframeWrapperEl.classList.add("presenting");
	                    iframeInnerEl.classList.add("presenting");
	                    
	                }
	                presentTextEl.classList.add("presenting");
	                downArrowEl.classList.add("presenting");
	                requestAnimationFrame(checkiframeReadyState);
	                navIsHidden = true;
	            } else if (currScroll + 10 < pageHeight && navIsHidden) {
	                navEl.classList.remove("tucked");
	                iframeWrapperEl.classList.remove("presenting");
	                iframeInnerEl.classList.remove("presenting");
	                presentTextEl.classList.remove("presenting");
	                downArrowEl.classList.remove("presenting");
	                navIsHidden = false;
	            }
	            
	            if (currScroll + 10 >= pageHeight && !iframeRequested) {
	                ciframe = document.createElement("iframe");
	                ciframe.className = "recursiveFrame";
	                ciframe.frameBorder = "0";
	                ciframe.src = window.location.href.replace(location.hash,"") + "?";
	                ciframe.onload = function() {
	                    iframeLoaded = true;
	                };
	                iframeInnerEl.appendChild(ciframe);
	                browserURLinput.value = top.location.href.replace(top.location.hash,"");
	                iframeRequested = true;
	            }
	        }
	        
	        
	        
	        window.onscroll = scrollChange;
	        scrollChange();
	        
		</script>
		
	</body>
</html>
